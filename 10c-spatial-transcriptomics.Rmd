```{r, include = FALSE}
ottrpal::set_knitr_image_path()
```

# Spatial transcriptomics

::: warning
This chapter chapter has currently been written by ChatGPT and has not been verified by experts. We need help writing and reviewing it! If you wish to contribute, please [go to this form](https://forms.gle/dqYgmKH8XXE2ohwD9) or our [GitHub page](https://github.com/fhdsl/Choosing_Genomics_Tools).
:::

## Learning Objectives

```{r, fig.alt = "This chapter will demonstrate how to: Approach collection of spatial transcriptomics data and design a typical analysis pipeline. Adjust your analysis pipeline to the research question, opportunities, and limitations concerning you spatial transcriptomics project. Learn about the questions that can be addressed with spatial transcriptomics data", out.width = "100%", echo = FALSE}
ottrpal::include_slide("https://docs.google.com/presentation/d/1YwxXy2rnUgbx_7B7ENH9wpDX-j6JpJz6lGVzOkjo0qY/edit#slide=id.g15bed4cad37_396_1")
```

## What are the goals of spatial transcriptomic analysis?

Spatial transcriptomics (ST) technologies have been developed as a solution to the lack of spatial context in single cell transcriptomics (scRNA-seq) data [@rao2021exploring; @ospina2023primer]. There is a diversity of ST methods, however all have in common two features: Multiple measurements of gene expression and the locations within the tissue where those gene expression measurements were taken. Data analysis of ST data requires integration of those two components, and it's primary goal is to characterize gene expression patterns within the tissue or cellular context. The ability to quantify gene expression at different locations within the tissue is of tremendous value to understand the functional variation of different tissue regions, domains, or niches. It also places cell-cell communication in the context of cell neighborhoods, which ultimately facilitates a deeper understanding of cell and tissue biology, but also enables practical applications such as discovery of novel drug targets for complex diseases such as cancer [@dries2021advances; @williams2022introduction]. Following, are some of the specific goals that a study using ST could achieve:

1.  **Describe tissue-specific cellular neighborhoods of cell types and cell type sub-populations:** Although scRNA-seq continues to be a powerful method to assign biological identities to a mixture of cells, integrated analysis of ST combined with scRNA-seq adds crucial information to cell phenotypes by describing the neighborhoods where cells occur [@longo2021integrating]. Many methods to phenotype ST data are available, with most of them relying on the availability of a curated (scRNA-seq) cell type reference. Once cell identities have been determined, clustering or spatial statistics can be applied to describe the composition of tissue niches or domains. The explosion of ST data has resulted on novel and comprehensive tissue- or disease-specific atlases, not only describing the cell types within organs, but also the functional cell-cell relationships that result from spatial organization (e.g., @guilliams2022spatial; @wu2021single).
2.  **Uncover spatially regulated biological processes:** With ST data, there comes the ability to detect genes or gene pathways that are expressed in specific areas within tissues (i.e., spatially-restricted expression). Detecting genes with spatially-restricted expression is key to achieve further understanding of specific biological processes, such as tissue gradients, cell differentiation, or signaling pathways. For example, cancer researchers are now able to study signaling pathways restricted to the tumor-stroma interface [@hunter2021spatially], which could lead to the discovery of mechanisms representing cancer vulnerabilities resulting from interactions between the tumor and stroma cells.
3.  **Investigate cell-cell interactions:** From basic to applied tissue biology research, the study of cell-cell interactions is of high interest, especially the interactions that occur via ligand-receptor pairs. The construction of comprehensive databases of ligand-receptor interactions has been possible due the large amounts of single-cell data sets produced by researchers. A major contribution of ST to the study of tissue biology is the addition of the spatial context to previously identified ligand-receptor interactions. Because single-cell RNA-seq requires physical separation of cells, current ligand-receptor databases represent hypotheses which ST can help to address by using models of spatial co-localization, enabling in-situ examination of cell-cell interactions and communication [@raredon2023comprehensive; @wang2023promising].
4.  **Integrate imaging data:** Spatial transcriptomics data has enabled direct integration of gene expression measurements with digital images of the same (or adjacent) tissue. Improved molecular description and/or exploration of tissue niches or domains is now possible. One approach consists on differential expression of histopathology annotations done by an expert on tissue images (e.g., @ravi2022spatially). The oppoosite approach is possible, which uses unsupervised clustering of ST data assisted by color/intensity information derived from images. Machine learning for integration of ST and imaging data is an active area of development (e.g., @hu2021spagcn; @xu2022deepst; @tan2020spacell). Furthermore, ST data findings can be qualitatively validated by assessing the approximate location of regions such as immune-infiltrated areas or damaged tissue, often resulting from inspection of fluorescence microscopy.
5.  **Identify biomarkers and drug targets:** The use of ST allows the exploration of tissue niche-specific expression patterns and gene pathway analysis. This exploration can lead to generation of hypotheses about potential biomarkers for specific tissue functions or disease states. Furthermore, the molecular interactions predicted using scRNA-seq (e.g., ligand-receptor), can now be put in context of the larger tissue architecture using ST data. The spatial context of these interactions will likely boost the identification of novel drug targets, as well as improved understanding of current therapies [@lyubetskaya2022assessment; @zhang2022clinical].

## Overview of a spatial transcriptomics workflow

There is a large diversity in approaches to spatially profile tissues. Some ST technologies allow profiling at coarse cellular resolution, where regions of interest (ROIs) are usually identified by a pathologist. These ROIs may include tens of cells up to few hundreds (e.g., GeoMx @bergholtz2021best). Smaller ROI sizes can be found in other technologies such as Visium, where ROIs of 55uM of diameter (or "spots") often contain no more than 10 cells (<https://www.10xgenomics.com/resources/analysis-guides/integrating-single-cell-and-visium-spatial-gene-expression-data>). For finer cellular resolution, technologies such as MERFISH, SMI, or Xenium, among others, can measure gene expression at individual cells [@yue2023guidebook]. In general, there is a trade-off between the cellular resolution and molecular resolution, as the number of quantified genes and RNA molecules is lower in single-cell level spatial technologies compared to those at the ROI or spot level. In single-cell ST, often a panel of hundreds of genes is quantified, while in "mini-bulk" (ROI/spot) ST, it is possible to genes at the whole transcriptome level.

FIGURE TRADEOFF CELLULAR AND MOLECULAR RESOLUTION

In addition to the differences in cellular and molecular, there are fundamental differences in the chemistry used to count the RNA transcripts in the tissue [@wang2021spatial; @yue2023guidebook]. Capture or hybridization of RNA followed by sequencing, or fluorescent imaging are two of the most common techniques used in ST methods. Because of large diversity in resolution and chemical procedures among ST technologies, data collection workflows are equally diverse. Nevertheless, some of the commonalities are presented here:

1.  **Sample Preparation:** The first step is to prepare the tissue sample for spatial transcriptomic analysis. This involves obtaining the tissue of interest, which could be a section from a biopsy, a thin slice from a tissue block, or a whole-mount tissue. The sample should be properly preserved and stabilized to maintain the integrity of RNA molecules.

2.  **Spatially Resolved Capture of RNA Molecules:** In this step, the tissue sample is typically placed on a solid substrate, such as a glass slide or a microarray chip. One common approach is to use spatially barcoded arrays or grids, where each region corresponds to a specific spatial location. Alternatively, techniques like in situ sequencing or imaging-based methods can be used. These approaches allow the capture of RNA molecules while retaining spatial information.

3.  **RNA Extraction and Amplification:** After spatial capture, the captured RNA molecules need to be extracted and amplified to generate sufficient material for downstream analysis. This step involves lysing the cells, extracting the RNA, and performing reverse transcription to convert RNA into complementary DNA (cDNA). Amplification methods such as PCR or in vitro transcription (IVT) are employed to generate amplified cDNA libraries.

4.  **Library Preparation:** The amplified cDNA libraries are then prepared for sequencing. This involves adding specific sequencing adapters and barcodes to each library, which enable sample multiplexing and identification during sequencing.

5.  **Sequencing:** The prepared libraries are subjected to high-throughput sequencing using platforms like Illumina or Ion Torrent. The choice of sequencing platform depends on the desired read length, throughput, and cost considerations.

6.  **Data Analysis:** After sequencing, the generated data undergoes bioinformatics analysis. This typically includes preprocessing steps such as read alignment or mapping to a reference genome, removing duplicate reads, and quantifying gene expression levels. The spatial coordinates associated with each read are also considered for spatial analysis, which involves assigning gene expression profiles to specific locations within the tissue.

7.  **Visualization and Interpretation:** The final step involves visualizing and interpreting the spatial transcriptomic data. Various tools and algorithms are available for spatial visualization, such as generating heatmaps, spatial expression plots, or clustering analysis. The data can be integrated with anatomical or imaging data to gain further insights into cellular organization and interactions within the tissue.

## Spatial transcriptomic data **strengths**:

-   **Preservation of Spatial Information:** Spatial transcriptomics allows the investigation of gene expression patterns within the context of tissue or cellular spatial organization. By preserving the spatial information of RNA molecules, it provides insights into how gene expression varies across different regions within a tissue sample.
-   **Identification of Cell Types and Subpopulations:** Spatial transcriptomics enables the identification and characterization of different cell types and subpopulations within a tissue sample based on their unique gene expression profiles. This information helps in understanding cellular heterogeneity and cell-cell interactions within the tissue.
-   **Visualization of Gene Expression Patterns:** By generating spatially resolved gene expression data, spatial transcriptomics allows for the visualization of gene expression patterns across the tissue sample. This visualization can be in the form of heatmaps, spatial expression plots, or spatially resolved gene expression atlases, providing a comprehensive view of gene expression within the tissue.
-   **Integration with Anatomical and Imaging Data:** Spatial transcriptomics data can be integrated with anatomical or imaging data, such as histological images or imaging modalities like fluorescence microscopy. This integration enhances the interpretation of spatial transcriptomic data by correlating gene expression patterns with tissue morphology or specific cellular structures.
-   **Discovery of Novel Cell-Cell Interactions and Signaling Pathways:** By examining gene expression profiles in the spatial context, spatial transcriptomics can uncover novel cell-cell interactions and signaling pathways within a tissue. It allows the identification of genes that are specifically expressed in close proximity to each other, revealing potential regulatory relationships and functional interactions between cells.
-   **Exploration of Spatially Regulated Biological Processes:** Spatial transcriptomics enables the investigation of spatially regulated biological processes, such as tissue gradients or developmental processes occurring in specific regions. It provides insights into spatially restricted gene expression patterns associated with tissue patterning, morphogenesis, or cellular differentiation.
-   **Hypothesis Generation and Biomarker Discovery:** Spatial transcriptomic analysis can generate hypotheses and identify potential biomarkers related to specific tissue functions or disease states. By linking gene expression patterns to tissue organization and pathology, spatial transcriptomics facilitates the discovery of spatially restricted gene signatures and potential diagnostic or prognostic markers.

## Spatial transcriptomic data **weaknesses**:

-   **Limited Spatial Resolution:** Spatial transcriptomic techniques have a finite spatial resolution, which determines the level of detail at which gene expression patterns can be analyzed. The resolution is influenced by factors such as the size of capture spots or the resolution of imaging techniques. Obtaining fine-grained spatial information may be challenging, especially in complex tissues or samples with high cellular density.
-   **Technical Variability and Experimental Artifacts:** Spatial transcriptomic analysis involves multiple experimental steps, including tissue processing, capture techniques, and sequencing. Each step introduces technical variability and potential experimental artifacts, which can impact the accuracy and reproducibility of the results. Controlling and minimizing these sources of variation is crucial but can be challenging.
-   **Limited Coverage of Transcripts:** Spatial transcriptomic methods often have limited coverage of the entire transcriptome. The capture techniques used may bias the representation of certain RNA molecules or favor highly expressed transcripts, potentially leading to a biased view of gene expression. Additionally, spatial transcriptomic methods may have limitations in capturing non-polyadenylated RNAs or low-abundance transcripts.
-   **Complex Data Analysis:** Analyzing spatial transcriptomic data requires advanced computational methods and expertise. Data analysis involves multiple steps, including image processing, spatial registration, normalization, and interpretation. The complexity of the data and the need for specialized bioinformatics tools and pipelines can pose challenges, particularly for researchers without extensive computational skills.
-   **Validation and Integration Challenges:** Spatial transcriptomic analysis generates hypotheses and provides spatially resolved gene expression information. However, validating the functional significance of identified gene expression patterns or cellular interactions may require additional experiments or techniques. Integrating spatial transcriptomic data with other omics data or imaging modalities can also be complex and may require careful data integration strategies.
-   **Cost and Time Considerations:** Spatial transcriptomic analysis can be relatively expensive and time-consuming compared to traditional transcriptomic techniques. The specialized protocols, reagents, and instrumentation required can add to the cost of the analysis. Moreover, the data generation and analysis processes can be time-intensive, which may limit the scalability of studies involving large sample sizes.
-   **Limited Accessibility of Techniques:** Some spatial transcriptomic techniques may have limited availability, accessibility, or may require specialized equipment or expertise. This can restrict their widespread use and accessibility to researchers who do not have access to the necessary resources or infrastructure.

## Tools for spatial transcriptomics

### Data processing:

#### Space Ranger:

-   **Pros:** spaceranger is a software package developed by 10x Genomics specifically for processing and analyzing spatial transcriptomic data generated by their platform. It provides a streamlined workflow for processing raw data, including image processing, spot calling, and counting transcripts. spaceranger offers integration with the Seurat R package, enabling downstream analysis using Seurat's extensive tools.
-   **Cons:** spaceranger is optimized for 10x Genomics data and may have limited compatibility with other spatial transcriptomic platforms. It may not offer the same level of flexibility as more general-purpose tools like Seurat or Scanpy.

#### GeomxTools

-   **Pros:**
-   **Cons:**

### Data exploration:

#### Seurat:

-   **Pros:** Seurat is a widely used R package that offers a comprehensive suite of tools for spatial transcriptomic analysis. It provides a variety of functions for data preprocessing, dimensionality reduction, clustering, and visualization. Seurat has a large user community, extensive documentation, and tutorials, making it accessible to researchers.
-   **Cons:** Seurat can be memory-intensive, particularly when working with large datasets. It may require familiarity with R programming and bioinformatics concepts for effective use. Additionally, Seurat's performance can depend on the specific computational resources available.

#### Scanpy:

-   **Pros:** Scanpy is a Python-based library specifically designed for single-cell and spatial transcriptomic analysis. It offers a range of functionalities for data preprocessing, clustering, trajectory analysis, and visualization. Scanpy is known for its scalability, efficiency, and flexibility. It integrates well with other Python libraries and frameworks, making it suitable for integration with other analysis pipelines.
-   **Cons:** Similar to Seurat, Scanpy may require some familiarity with Python programming and bioinformatics concepts. Users without prior programming experience may need to invest time in learning Python.

#### Giotto:

-   **Pros:** .
-   **Cons:** .

#### spatialGE:

-   **Pros:** .
-   **Cons:** .

#### Loupe:

-   **Pros:** .
-   **Cons:** .

#### ST Pipeline:

-   **Pros:** ST Pipeline is an open-source bioinformatics pipeline developed by the Spatial Transcriptomics consortium. It provides a complete workflow for spatial transcriptomic data analysis, including preprocessing, normalization, spot detection, and visualization. ST Pipeline supports various spatial transcriptomic platforms, making it versatile.
-   **Cons:** ST Pipeline may require some command-line proficiency and familiarity with Linux environments. Users may need to invest time in setting up the pipeline and configuring parameters based on their specific datasets and platforms.

### Clustering/tissue domain identification:

#### SpaGCN:

-   **Pros:** .
-   **Cons:** .

### Spatially variable gene identification:

#### SpatialDE:

-   **Pros:** SpatialDE is a Python package designed for detecting spatially variable genes from spatial transcriptomic data. It offers statistical methods to identify genes that exhibit spatial heterogeneity in expression across the tissue. SpatialDE provides a straightforward implementation for identifying spatially variable genes and their spatial patterns.
-   **Cons:** SpatialDE focuses on the identification of spatially variable genes and may not provide a comprehensive set of tools for the entire spatial transcriptomic analysis pipeline. Additional tools may be required for preprocessing, visualization, and downstream analysis.

### Deconvolution/phenotyping:

#### SPOTlight:

-   **Pros:** .
-   **Cons:** .

#### STdeconvolve:

-   **Pros:** .
-   **Cons:** .

#### InSituType:

-   **Pros:** .
-   **Cons:** .

#### SpatialDecon:

-   **Pros:** .
-   **Cons:** .

### Cell communication:

#### CellChat:

-   **Pros:** .
-   **Cons:** .

## More tools and tutorials regarding spatial transcriptomics

-   [Analysis, visualization, and integration of spatial datasets with Seurat](https://satijalab.org/seurat/articles/spatial_vignette.html)
-   [Sheffield Bioinformatics tutorial for spatial transcriptomics](https://github.com/sheffield-bioinformatics-core/spatial_transcriptomics_tutorial)
-   [Theis Lab SCOG workshop materials for spatial transcriptomics](https://github.com/theislab/spatial_scog_workshop_2022)
